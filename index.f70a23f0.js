let e,t,i,s,a,n;function r(e,t){if(!t[e])return"";let i=t[e].defn;if(!i)return"";let s=/[{<](.*?)?=.*?[>}]/g.exec(i);if(s){let e=t[s[1].toUpperCase()];i=e?.defn?`${s[1]} (${e.defn})`:s[1]}return i.replace(/\{(.*?)=.*?\}/g,"$1").replace(/<(.*?)=.*?>/g,"$1").replace(/\s*?\[.*?\]\s*?/g,"")}function d(e,t,i){let s=t[e];return s&&(!s.dict||s.dict.includes(i.charAt(0)))}function l(e){let t=[],i=new Set;for(let s of e){let a=s.split("").reverse().join("");if(a!==s&&e.includes(a)){let e=`${[s,a].sort().join(" ")}`;i.has(e)||(i.add(e),t.push(`(${s}`,`${a})`))}else t.push(s)}return t}e=null,t=null,i=0,s=0,a=null,n=null,"function"!=typeof window.CustomEvent&&(window.CustomEvent=(e,t)=>{t=t||{bubbles:!1,cancelable:!1,detail:void 0};let i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i},window.CustomEvent.prototype=window.Event.prototype),document.addEventListener("touchstart",function(r){let d=document.getElementById("board");d?.contains(r.target)||(n=r.target,a=Date.now(),e=r.touches[0].clientX,t=r.touches[0].clientY,i=0,s=0)},!1),document.addEventListener("touchmove",function(a){e&&t&&(i=e-a.touches[0].clientX,s=t-a.touches[0].clientY)},!1),document.addEventListener("touchend",function(r){if(n!==r.target)return;let d=Date.now()-a,l="";Math.abs(i)>Math.abs(s)?Math.abs(i)>100&&d<500&&(l=i>0?"swiped-left":"swiped-right"):Math.abs(s)>100&&d<500&&(l=s>0?"swiped-up":"swiped-down"),l&&n.dispatchEvent(new CustomEvent(l,{bubbles:!0,cancelable:!0})),e=null,t=null,a=null},!1),(()=>{let e="ontouchstart"in window||navigator.maxTouchPoints>0,t=e?"touchend":"mouseup",i=null,s=0,a=0;function n(e){return"touches"in e}function r(){i&&window.cancelAnimationFrame(i.value),i=null}"function"!=typeof window.CustomEvent&&(window.CustomEvent=(e,t)=>{t=t||{bubbles:!1,cancelable:!1,detail:void 0};let i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i},window.CustomEvent.prototype=window.Event.prototype),document.addEventListener(t,r,!0),document.addEventListener(e?"touchmove":"mousemove",function(e){let t=Math.abs(s-(n(e)?e.touches[0].clientX:e.clientX)),i=Math.abs(a-(n(e)?e.touches[0].clientY:e.clientY));(t>=10||i>=10)&&r()},!0),document.addEventListener("wheel",r,!0),document.addEventListener("scroll",r,!0),document.addEventListener(e?"touchstart":"mousedown",function(e){let d=document.getElementById("board");d?.contains(e.target)||(s=n(e)?e.touches[0].clientX:e.clientX,a=n(e)?e.touches[0].clientY:e.clientY,function(e){r();let s=new Date().getTime(),a=()=>{new Date().getTime()-s>=(e.target?.id==="title"?5e3:500)?function(e,i){r();let s=n(i)?i.touches[0].clientX:i.clientX,a=n(i)?i.touches[0].clientY:i.clientY;e.dispatchEvent(new CustomEvent("long-press",{bubbles:!0,cancelable:!0,detail:{clientX:s,clientY:a}}))&&document.addEventListener(t,t=>{t.stopImmediatePropagation(),t.preventDefault(),t.stopPropagation(),e.dispatchEvent(new CustomEvent("long-press-up",{bubbles:!0,cancelable:!0,detail:{clientX:s,clientY:a}}))},{once:!0,capture:!0})}(e.target,e):i.value=window.requestAnimationFrame(a)};i={value:window.requestAnimationFrame(a)}}(e))},!0)})();class o{constructor(e,t){for(let i in this.dict=t,this.percentiles=e,this.mixed={},t){let e=o.toAnagram(i);this.mixed[e]=this.mixed[e]||[],this.mixed[e].push(i)}}anagrams(e,t,i){let s=o.toAnagram(e),a=this.mixed[s],n={words:[]};if(!a)return n;for(let e of a)if((!i||!(e.length<i))&&d(e,this.dict,t)){n.words.push(e);let t=this.dict[e];for(let e of["n","o","b"])t[e]&&(n[e]=(n[e]||0)+t[e])}return n}stats(e,t="New",i="NWL"){let s=this.dict[e],a=this.anagrams(e,i);if(!d(e,this.dict,i)||!a.words.length)return{grade:" "};let n=void 0===s.freq?-1:this.percentiles.freqs.findIndex(e=>e<=s.freq),r=-1===n?" ":n>=99?" ":n>=20?"A":n>=10?"B":n>=5?"C":"D",l=this.percentiles[t][i],o=t.charAt(0).toLowerCase(),c=s[o]||0,u=l.words.findIndex(e=>e<=c),p=h(u),m=a[o]||0,g=l.anagrams.findIndex(e=>e<=m),E=[" ","A","B","C","D"][Math.ceil((p+h(g))/2)],f=e=>Math.round(100*e/l.total*1e3)/1e3,w={grade:E<r?r:E};return n>-1&&(w.freq=n),u>-1&&(w.word={p:u,v:f(s.freq)}),g>-1&&(w.anagram={p:g,v:f(m)}),w}history(e,t,i){let s=t.charAt(0).toLowerCase(),a=e=>e.split("").reverse().join(""),n={},r={},d={},h={},c={},u={},p=e.length;for(let[t,i]of e){let e={};for(let d in t){h[d]=(h[d]||0)+1;let l=o.toAnagram(d);if(e[l]=e[l]||[],e[l].push(d),i.has(d)){u[d]=(u[d]||0)+1;let e=a(d);if(e!==d&&t[e]){let t=[d,e].sort()[0];i.has(e)?d===t&&(c[t]=(c[t]||0)+1):(c[t]=(c[t]||0)+1,r[t]=(r[d]||0)+1/p*this.dict[t][s])}}else n[d]=(n[d]||0)+1/p*this.dict[d][s]}for(let t in e){let a=e[t];if(a.length<=1)continue;let n=a.filter(e=>i.has(e)).length/a.length;if(!n)continue;let r=a.reduce((e,t)=>e+this.dict[t][s],0)/a.length;d[t]=(d[t]||0)+1/p*r*(1-n)}p--}let m=Math.log(e.length);for(let e in h){if(n[e]+=m*this.dict[e][s]*Math.pow(1-(u[e]||0)/h[e],2),r[e]){let t=a(e),[i,n]=(u[t]||0)>(u[e]||0)?[e,t]:[t,e];r[e]+=m*this.dict[e][s]*2*Math.pow(1-(u[i]||0)/(h[n]||1),2)}d[o.toAnagram(e)]&&h[e]&&(d[e]+=m*this.dict[e][s]*Math.pow(1-(u[e]||0)/h[e],2))}let g=(e,t)=>Object.entries(e).sort((e,t)=>t[1]-e[1]).slice(0,t);return{words:g(n,100).map(e=>({w:e[0],found:u[e[0]]||0,all:h[e[0]]||0})),anadromes:g(r,50).map(e=>{let t=e[0],i=a(t),[s,n]=(u[i]||0)>(u[t]||0)?[t,i]:[i,t];return{n:s,fn:u[s]||0,d:n,fd:u[n]||0,e:c[t]||0}}),anagrams:g(d,50).map(e=>{let t=[];for(let s of l(this.anagrams(e[0],i).words)){let e=s.replace(/[^A-Z]/,"");t.push({raw:s,found:u[e]||0,all:h[e]||0})}return t})}}static toAnagram(e){return e.split("").sort().join("")}}function h(e){return e>=75?0:e>=50?1:e>=25?2:e>=10?3:4}class c{static async setup(e="keyval",t=["keyval"]){return new Promise((i,s)=>{let a=indexedDB.open(e,1);a.onerror=()=>s(a.error),a.onsuccess=()=>i(a.result),a.onupgradeneeded=()=>{for(let e of t)a.result.createObjectStore(e)}})}constructor(e="keyval",t="keyval"){this.dbName=e,this.storeName=t,this.db=new Promise((i,s)=>{let a=indexedDB.open(e,1);a.onerror=()=>s(a.error),a.onsuccess=()=>i(a.result),a.onupgradeneeded=()=>{a.result.createObjectStore(t)}})}get(e){let t;return this.withIDBStore("readonly",i=>{t=i.get(e)}).then(()=>t.result)}set(e,t){return this.withIDBStore("readwrite",i=>{i.put(t,e)})}withIDBStore(e,t){return this.db.then(i=>new Promise((s,a)=>{let n=i.transaction(this.storeName,e);n.oncomplete=()=>s(),n.onabort=n.onerror=()=>a(n.error),t(n.objectStore(this.storeName))}))}}class u{constructor(e=4){e=61^e^e>>>16,e+=e<<3,e^=e>>>4,e=Math.imul(e,668265261),e^=e>>>15,this.seed=e>>>0}next(e,t){e&&(e=Math.floor(e)),t&&(t=Math.floor(t));let i=this.seed+=1831565813;i=Math.imul(i^i>>>15,1|i),i^=i+Math.imul(i^i>>>7,61|i);let s=(i=(i^i>>>14)>>>0)/4294967296;return void 0===e?s:t?Math.floor(s*(t-e))+e:Math.floor(s*e)}shuffle(e){for(let t=e.length-1;t>0;t--){let i=Math.floor(this.next()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}sample(e,t=!1){if(0===e.length)throw RangeError("Cannot sample an empty array");let i=this.next(e.length),s=e[i];if(t&&(e[i]=e[e.length-1],e.pop()),void 0===s&&!Object.prototype.hasOwnProperty.call(e,i))throw RangeError("Cannot sample a sparse array");return s}}function p(e,t){return e<t?-1:e>t?1:0}class m{constructor(e=[],t=p){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this.down(e)}push(e){this.data.push(e),this.length++,this.up(this.length-1)}pop(){if(0===this.length)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this.down(0)),e}peek(){return this.data[0]}up(e){let t=this.data[e];for(;e>0;){let i=e-1>>1,s=this.data[i];if(this.compare(t,s)>=0)break;this.data[e]=s,e=i}this.data[e]=t}down(e){let t=this.length>>1,i=this.data[e];for(;e<t;){let t=(e<<1)+1,s=this.data[t],a=t+1;if(a<this.length&&0>this.compare(this.data[a],s)&&(t=a,s=this.data[a]),this.compare(s,i)>=0)break;this.data[e]=s,e=t}this.data[e]=i}}class g{static async create(e,t,i,s,a){let n=t.toLowerCase()[0],r=new m([],(e,t)=>e.d-t.d),d=new Set,l=await s.get("data");if(l)for(let e of(r.data=l,r.length=l.length,l))d.add(e.k);let o=[];for(let t in e.mixed)if(!d.has(t)){let s=e.anagrams(t,i,a)[n]||0;s&&o.push({k:t,w:s})}return o.sort((e,t)=>e.w-t.w),new g(o.map(e=>e.k),r,n,i,s,e)}constructor(e,t,i,s,a,n){this.unlearned=e,this.learned=t,this.size=t.length,this.d=i,this.type=s,this.store=a,this.stats=n}overdue(){let e=+new Date,t=[],i=this.size===this.learned.length?0:1;for(let s=this.learned.pop();s&&(t.push(s),!(s.d>e));s=this.learned.pop())i++;for(let e of t)this.learned.push(e);return i}next(){let e=+new Date,t=()=>{if(this.unlearned.length)return{k:this.unlearned.pop(),e:2.5,c:0,n:0,d:0,p:0}},i=this.learned.pop();if(i){if(i.d>e){let e=t();e&&(this.learned.push(i),i=e)}}else i=t();if(!i)throw RangeError();let s=i.k,a=this.stats.anagrams(s,this.type).words,n=()=>{this.learned.push(i),this.size=this.learned.length},r=new u(i.n);for(let e=0;e<10&&(s=r.shuffle(s.split("")).join(""),a.includes(s));e++);return{label:s,group:l(a),update:t=>(i=function(e,t,i){let s=-.8+.28*t-.02*t*t;if(s<0&&(s*=Math.min(2.5*Math.pow(2,e.n+1),100)/100),t>=3){let t=e.d?Math.min(2,(e.d-e.p)/864e5/(e.c?3:1)):1;e.c++,e.e=Math.max(1.3,e.e+s*t),e.d=i+2592e5*Math.pow(e.e,e.c-1)*t}else e.c=0,e.e=Math.max(1.3,e.e+s),e.d=i+864e5;return e.n++,e.p=i,e}(i,t,e),n(),this.store.set("data",this.learned.data)),restore:n}}}const E=["AAEEGN","ELRTTY","AOOTTW","ABBJOO","EHRTVW","CIMOTU","DISTTY","EIOSST","DELRVY","ACHOPS","HIMNQU","EEINSU","EEGHNW","AFFKPS","HLNNRZ","DEILRX"],f=["AACIOT","AHMORS","EGKLUY","ABILTY","ACDEMP","EGINTV","GILRUW","ELPSTU","DENOSW","ACELRS","ABJMOQ","EEFHIY","EHINPS","DKNOTU","ADENVZ","BIFORX"],w=["AAAFRS","AAEEEE","AAFIRS","ADENNN","AEEEEM","AEEGMU","AEGMNN","AFIRSY","BJKQXZ","CCNSTW","CEIILT","CEILPT","CEIPST","DDLNOR","DHHLOR","DHHNOT","DHLNOR","EIIITT","EMOTTT","ENSSSU","FIPRSY","GORRVW","HIPRRY","NOOTUW","OOOTTU"],S=["S","ER","ED","ING"];class v{constructor(e,t,i,s,a={dice:"New",dict:"NWL"}){for(let n of(this.trie=e,this.dict=t,this.stats=i,this.dice="Big"===a.dice?w:"Old"===a.dice?f:E,this.size=Math.sqrt(this.dice.length),a.min=a.min||this.size-1,this.settings=a,this.random=s,this.seed=this.random.seed,this.board=[],this.dice)){let e=this.random.sample(n.split(""));this.board.push("Q"===e?"Qu":e)}this.random.shuffle(this.board),this.possible=this.solve(),this.id=v.encodeID(this.settings,this.seed),this.played={},this.overtime=new Set,this.score={regular:0,overtime:0},this.start=+new Date,this.expired=null}play(e){if(!this.played[e]&&e.length>=this.settings.min){if(this.possible[e]){this.played[e]=+new Date;let t=v.score(e);this.expired&&this.overtime.add(e);let i=this.expired?"overtime":"regular";return this.score[i]+=t,t}this.played[e]=-new Date,this.expired&&this.overtime.add(e)}return 0}toJSON(){return{seed:this.id,start:this.start,expired:this.expired,words:this.played,goal:{S:this.totals.s,A:this.totals.a,B:this.totals.b,C:this.totals.c,D:this.totals.d}}}static encodeID(e,t){return`${e.dice.charAt(0)}${e.min}${e.dict.charAt(0)}${t}`}static decodeID(e){let t=e.charAt(0),i=Number(e.charAt(1));(isNaN(i)||i<3||i>5)&&(i=void 0);let s=e.charAt(2),a=e.slice(3),n=a.length?Number(a):NaN;return String(n)!==a&&(n=NaN),[{dice:"N"===t?"New":"O"===t?"Old":"B"===t?"Big":void 0,min:i,dict:"N"===s?"NWL":"E"===s?"ENABLE":"C"===s?"CSW":void 0},n]}static fromJSON(e,t,i,s){let[a,n]=v.decodeID(e.seed),r=new u;r.seed=n;let d=new v(t,i,s,r,a);d.start=e.start,d.expired=e.expired,d.played=e.words;let l={regular:0,overtime:0};for(let e in d.played){if(d.played[e]<0)continue;let t=v.score(e);!d.expired||d.played[e]<=d.expired?l.regular+=t:l.overtime+=t}return d.score=l,d}get totals(){if(this.totals_)return this.totals_;let e={},t={};for(let i in this.possible){let s=o.toAnagram(i);e[s]=e[s]||[],e[s].push(i);let a=this.stats.stats(i,this.settings.dice,this.settings.dict).grade;t[a]=(t[a]||0)+v.score(i)}let i=t.D||0,s=i+(t.C||0),a=s+(t.B||0),n=a+(t.A||0),r=n+(t[" "]||0);return this.totals_={s:r,a:n,b:a,c:s,d:i,anagrams:e}}progress(){let e=0,t=0,i=0,s={},a=new Set,n={};for(let r in this.played){if(e++,this.played[r]<0){t++;continue}for(let e of(i++,S)){let t;t=["ER","ED"].includes(e)&&r.endsWith("E")?`${r}${e.charAt(1)}`:"S"===e&&(r.endsWith("S")||r.endsWith("X"))?`${r}ES`:`${r}${e}`,this.possible[t]&&!this.played[t]&&(s[t]=r)}let d=o.toAnagram(r);for(let e of(n[d]=n[d]||[],n[d].push(r),function(e,t){let i=new Set;for(let s=0;s<e.length;s++)for(let a=1;a<=e.length-s;a++){let n=e.substr(s,a);n.length>=t&&i.add(n)}return i}(r,this.settings.min)))this.possible[e]&&!this.played[e]&&a.add(e)}let r=[];for(let e in n)r=r.concat(this.totals.anagrams[e].filter(t=>!n[e].includes(t)));let d=new Set([...Object.keys(s),...a,...r]);return{invalid:t,valid:i,total:e,score:this.score.regular+this.score.overtime+Array.from(d).reduce((e,t)=>v.score(t)+e,0),suffixes:s,subwords:a.size,anagrams:r.length,missing:d}}state(){let e=this.progress(),t=e=>this.stats.stats(e,this.settings.dice,this.settings.dict).grade,i=e=>({word:e,grade:t(e),defn:r(e,this.dict)});return{played:Array.from(Object.entries(this.played)).sort((e,t)=>Math.abs(e[1])-Math.abs(t[1])).map(e=>{let t=e[0],s=i(t);return e[1]<0&&(s.invalid=!0),this.overtime.has(t)&&(s.overtime=!0),s}),remaining:Object.keys(this.possible).filter(e=>!this.played[e]).sort((i,s)=>{let a=e.missing.has(i),n=e.missing.has(s);if(a&&!n)return -1;if(n&&!a)return 1;let r=t(i),d=t(s);return r>d?-1:d>r||i.length>s.length?1:s.length>i.length?-1:o.toAnagram(i).localeCompare(o.toAnagram(s))}).map(t=>{let s=i(t);return e.missing.has(t)&&(s.missing=!0),e.suffixes[t]&&(s.root=e.suffixes[t]),s}),progress:e,totals:this.totals}}solve(){let e={},t=[];for(let e=0;e<this.size;e++)for(let i=0;i<this.size;i++){let s=this.board[this.size*e+i],a=s.charCodeAt(0),n=this.trie.children[a-65];"Qu"===s&&void 0!==n&&(s="QU",n=n.children[20]),void 0!==n&&t.push([i,e,s,n,[[i,e]]])}for(;0!==t.length;){let[i,s,a,n,r]=t.pop();for(let[d,l]of[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]]){let[o,h]=[i+d,s+l];if(void 0===r.find(e=>e[0]===o&&e[1]===h)&&o>=0&&o<this.size&&h>=0&&h<this.size){let i=r.slice();i.push([o,h]);let s=this.board[this.size*h+o],d=n.children[s.charCodeAt(0)-65];if("Qu"===s&&void 0!==d&&(s="QU",d=d.children[20]),void 0!==d){let n=a+s;("boolean"==typeof d.isWord?d.isWord:d.isWord.includes(this.settings.dict.charAt(0)))&&n.length>=this.settings.min&&(e[n]=i),t.push([o,h,n,d,i])}}}}return e}static score(e){return e.length<3?0:e.length<=4?1:5===e.length?2:6===e.length?3:7===e.length?5:11}}class T{constructor(e,t){this.parent=e,this.children=Array(26),this.isWord=!1,null!==e&&(e.children[t.charCodeAt(0)-65]=this)}static create(e){let t=new T(null,"");for(let i in e){let s=t;for(let e of i){let t=e.charCodeAt(0),i=s.children[t-65];void 0===i&&(i=new T(s,e)),s=i}s.isWord=e[i].dict||!0}return t}}const C=new c("db","store"),y=e=>fetch(e,{mode:"no-cors"}).then(e=>e.json()),I={SETTINGS:JSON.parse(localStorage.getItem("settings"))||{dice:"New",min:3,dict:"NWL",grade:"D",shortcuts:"None",display:"Show",theme:"System"},STORE:C,LIMIT:500,MAX_SEED:1e12,DICT:void 0,STATS:void 0,HISTORY:void 0,TRIE:void 0,GAMES:void 0,PLAYED:void 0,SEED:0,LOADED:{DICT:y("data/dict.json").then(e=>{I.DICT=e}),TRIE:async()=>{I.TRIE||(await I.LOADED.DICT,I.TRIE=T.create(I.DICT))},STATS:async()=>{let e;I.STATS||(await Promise.all([I.LOADED.DICT,y("data/stats.json").then(t=>{e=t})]),I.STATS=new o(e,I.DICT))},HISTORY:C.get("history").then(e=>{I.HISTORY=e||[]}),TRAINING:c.setup("training",["NWL","ENABLE","CSW"]),GAMES:async()=>{if(!I.GAMES){await Promise.all([I.LOADED.HISTORY,I.LOADED.TRIE(),I.LOADED.DICT,I.LOADED.STATS()]),I.GAMES=[];for(let e=I.HISTORY.length-1;e>=0&&I.GAMES.length<I.LIMIT;e--){let t=v.fromJSON(I.HISTORY[e],I.TRIE,I.DICT,I.STATS),i=new Set;for(let e in t.played)t.played[e]>0&&i.add(e);I.GAMES.push([t.possible,i])}}},PLAYED:async()=>{if(!I.PLAYED)for(let e of(await I.LOADED.HISTORY,I.PLAYED=new Set,I.HISTORY))I.PLAYED.add(e.seed)}}};class b{constructor(e,t,i=0,s=null,a=null){this.duration=t,this.display=e,this.elapsed=i,this.interval=null,this.expireFn=s,this.updateFn=a,this.render()}toJSON(){return{duration:this.duration,elapsed:this.elapsed}}start(){this.interval||(this.begin=new Date().getTime(),this.last=this.begin,this.interval=setInterval(()=>this.update(),100))}stop(){this.interval&&(clearInterval(this.interval),this.interval=null,this.begin=new Date().getTime(),this.elapsed+=this.begin-this.last,this.last=this.begin)}toggle(){this.interval?this.stop():this.start()}expired(){return this.elapsed>=this.duration}update(){let e=new Date().getTime();this.elapsed+=e-this.last,this.last=e;let t=this.display.textContent;this.render(),t!==this.display.textContent&&this.updateFn&&this.updateFn()}render(){let e;this.expired()?(this.display.classList.add("expired"),e=this.elapsed-this.duration,this.expireFn&&(this.expireFn(),this.expireFn=null)):(this.display.classList.remove("expired"),e=this.duration-this.elapsed);let t=Math.floor(e%36e5/6e4),i=`${Math.floor(e%6e4/1e3)}`.padStart(2,"0"),s=`${t}:${i}`;s!==this.display.textContent&&(this.display.textContent=s)}}const L=e=>e.split("").every(e=>e>="A"&&e<="Z"||e>="a"&&e<="z");class A{constructor(e){this.last=e?e.last:"",this.kept=!!e&&e.kept,this.game=e?e.game:void 0,this.paused=!!e&&e.paused;let{display:t,timer:i}=this.createTimer(e?.timer);this.timer=i,this.timerDisplay=t,document.addEventListener("visibilitychange",()=>{document.hidden?this.timer.stop():this.paused||this.timer.start()})}toJSON(){return{last:this.last,kept:this.kept,paused:this.paused,timer:this.timer.toJSON(),game:this.game&&("random"in this.game?this.game.toJSON():this.game)}}async init(e={}){if(await Promise.all([I.LOADED.DICT,I.LOADED.TRIE(),I.LOADED.STATS(),I.LOADED.HISTORY,I.LOADED.PLAYED()]),!this.game||e.new){let t,i=I.SEED;this.game&&(this.timer.stop(),"random"in this.game||(this.game=v.fromJSON(this.game,I.TRIE,I.DICT,I.STATS)),this.game.seed===i&&(i=this.game.random.seed%I.MAX_SEED),I.PLAYED.add(this.game.id),Object.values(this.game.played).filter(e=>e>0).length&&(this.updateGames(),I.HISTORY.push(this.game.toJSON()),await I.STORE.set("history",I.HISTORY)));let s=new u;for(;!t||!Object.keys(t.possible).length;){s.seed=i;let a=v.encodeID(I.SETTINGS,s.seed);if(I.PLAYED.has(a)&&!e.allowDupes){i=(i+1)%I.MAX_SEED;continue}t=new v(I.TRIE,I.DICT,I.STATS,s,I.SETTINGS)}this.game=t,I.SEED=i;let{display:a,timer:n}=this.createTimer();this.timer=n,this.timerDisplay=a,this.last="",this.kept=!1,this.paused=!1}else"random"in this.game||(this.game=v.fromJSON(this.game,I.TRIE,I.DICT,I.STATS));let t=`#${this.game.id}`;document.location.hash!==t&&window.history.replaceState(null,"",t),this.full||(this.full=V.createElementWithId("div","full")),this.score||(this.score=V.createElementWithId("div","score"),this.displayScore())}async attach(e={}){await this.init(e),this.container=V.createElementWithId("div","game");let t="ontouchstart"in window||navigator.maxTouchPoints>0,i=V.createBackButton(()=>V.toggleView("Menu"));i.addEventListener("long-press",e=>(t&&e.preventDefault(),this.refresh({new:!0})));let s=V.createElementWithId("div","score-wrapper");return s.appendChild(this.score),s.addEventListener("mouseup",()=>V.toggleView("Score")),s.addEventListener("long-press",()=>this.onLongPress()),s.addEventListener("long-press-up",()=>this.onLongPressUp()),this.container.appendChild(V.createTopbar(i,this.timerDisplay,s)),this.container.appendChild(this.full),this.container.appendChild(this.renderBoard()),this.displayScore(),this.word=V.createElementWithId("input","word"),this.word.setAttribute("type","text"),this.word.classList.add("word"),this.word.addEventListener("beforeinput",e=>this.onBeforeInput(e)),t&&this.word.setAttribute("disabled","disabled"),this.container.appendChild(this.word),this.defn=V.createElementWithId("div","defn"),this.defn.classList.add("definition"),this.container.appendChild(this.defn),this.paused||this.timer.start(),this.container}renderBoard(){let e=this.game,t=V.createElementWithId("div","board-wrapper"),i=V.createElementWithId("table","board");e.size>4&&i.classList.add("big"),this.tds=new Set;let s=new u(e.seed);for(let t=0;t<e.size;t++){let a=document.createElement("tr");for(let i=0;i<e.size;i++){let n=document.createElement("td"),r=document.createElement("div");r.textContent=e.board[t*e.size+i],"Qu"===r.textContent&&r.classList.add("qu"),["M","W","Z"].includes(r.textContent)&&r.classList.add("underline"),r.classList.add(`rotate${90*s.next(0,4)}`),n.setAttribute("data-x",String(t)),n.setAttribute("data-y",String(i)),n.appendChild(r);let d=document.createElement("div");d.classList.add("target"),d.setAttribute("data-x",String(t)),d.setAttribute("data-y",String(i)),n.appendChild(d),a.appendChild(n),this.tds.add(n)}i.appendChild(a)}let a=new Set,n=()=>{for(let e of a)e.classList.remove("selected")},r=e=>{let t=e.touches[0],i=document.elementFromPoint(t.clientX,t.clientY);if(i?.matches(".target")){let e=i.parentNode;e.classList.add("selected"),a.has(e)||(a.add(e),this.word.value+=e.textContent)}};return i.addEventListener("touchstart",e=>{this.clear(),n(),a=new Set,r(e)}),i.addEventListener("touchend",()=>{n(),this.play()}),i.addEventListener("touchmove",r),t.appendChild(i),t}afterAttach(){V.permaFocus(this.word)}detach(e){return["Score","Define"].includes(e)||this.timer.stop(),this.container}async refresh(e={}){V.persist(),await V.detachView("Board","Board"),await V.attachView("Board",e)}play(){let e=this.game,t=(this.word.value||"").toUpperCase();if(!t.length)return;"Shortcuts"===I.SETTINGS.shortcuts&&(t.length<3||S.includes(t))&&(t=`${this.last}${t}`,this.word.value=t);let i=e.play(t);this.last=t,V.persist();let s="Hide"===I.SETTINGS.display;if(this.kept=!0,!s&&i)this.displayScore(),this.defn.textContent=r(t,I.DICT);else{let i=this.word.value||void 0;!s&&e.played[t]<0&&this.word.classList.add("error"),this.word.classList.add("fade"),this.word.addEventListener("animationend",()=>this.clear(i),{once:!0})}}displayScore(){let e=this.game;if("Hide"===I.SETTINGS.display){this.score.textContent="?",this.full.classList.add("hidden");return}if("Full"===I.SETTINGS.display){let t=e.state(),i=t.progress,s=`(${i.score}) ${Object.keys(i.suffixes).length}/${i.subwords}/${i.anagrams}`,a=e.score.regular+e.score.overtime,n=t.totals[I.SETTINGS.grade.toLowerCase()],r=Math.round(a/n*100).toFixed(0);this.full.classList.remove("hidden"),this.full.textContent=`${s} - ${a}/${n} (${r}%)`}else this.full.classList.add("hidden");let t=e.score;this.score.textContent=t.overtime?`${t.regular}\xa0/\xa0${t.overtime}`:`${t.regular}`}clear(e){e&&e!==this.word.value||(this.word.value="",this.word.classList.remove("error"),this.word.classList.remove("fade"),this.defn.textContent="",this.kept=!1)}createTimer(e){let t=V.createElementWithId("div","timer");t.addEventListener("click",()=>{this.timer.toggle(),this.paused=!this.paused});let i=new b(t,e?e.duration:18e4,e?e.elapsed:0,()=>{this.game&&!this.game.expired&&(this.game.expired=+new Date)},()=>V.persist());return{display:t,timer:i}}updateGames(){if(!I.GAMES)return;let e=this.game,t=new Set;for(let i in e.played)e.played[i]>0&&t.add(i);t.size&&(I.GAMES.length>=I.LIMIT&&I.GAMES.shift(),I.GAMES.push([e.possible,t]))}onLongPress(){let e=this.game,t=e.size,i=[];for(let e=0;e<t;e++){let e=[];for(let i=0;i<t;i++)e.push(0);i.push(e)}let s=0;for(let t in e.possible){if(e.played[t])continue;let a=v.score(t);for(let n of(s+=a,e.possible[t]))i[n[1]][n[0]]+=a}for(let e of this.tds){let t=i[Number(e.dataset.x)][Number(e.dataset.y)]/s;e.style.backgroundColor=`rgba(255,0,0,${t})`}}onLongPressUp(){for(let e of this.tds)e.style.removeProperty("background-color")}onBeforeInput(e){!(e.inputType.startsWith("delete")||e.data&&L(e.data))&&(e.preventDefault(),(["insertLineBreak","insertParagraph"].includes(e.inputType)||e.data?.includes(" "))&&this.play())}async onKeyDown(e){if(!this.word)return;this.kept&&this.clear();let t=e.keyCode;13===t||32===t?(e.preventDefault(),this.play()):(this.word.value||37!==t&&39!==t)&&([0,37,39,8,46].includes(t)||L(String.fromCharCode(t)))||e.preventDefault()}}const D=e=>e.split("").every(e=>e>="A"&&e<="Z"||e>="a"&&e<="z");class N{constructor(e){this.defn=null,this.stats=null,this.anagrams=null,this.word=e?e.word:""}toJSON(){return{word:this.word}}async attach(e){return await Promise.all([I.LOADED.DICT,I.LOADED.STATS()]),e&&(this.word=e),this.define=V.createElementWithId("div","define"),this.search=V.createElementWithId("input","search"),this.search.setAttribute("type","text"),this.search.classList.add("word"),this.search.value=this.word,this.search.addEventListener("beforeinput",e=>this.onBeforeInput(e)),this.search.addEventListener("input",()=>{let e=this.search.value;this.query(e&&D(e)?e:"")}),this.define.appendChild(this.search),this.update(),this.define}afterAttach(){V.permaFocus(this.search)}query(e){this.search.value=e,this.word=e.toUpperCase(),this.update(),V.persist()}detach(){return this.defn=null,this.stats=null,this.anagrams=null,this.define}update(){let e=I.DICT[this.word];if(e){let t=V.createElementWithId("div","defineDefn");t.classList.add("definition"),t.textContent=r(this.word,I.DICT),e.dict&&!e.dict.includes(I.SETTINGS.dict.charAt(0))||this.word.length<I.SETTINGS.min?this.define.classList.add("hard"):this.define.classList.remove("hard");let i=(e,t,i)=>{let s=document.createElement("td"),a=document.createElement("b");a.textContent=t,s.appendChild(a),e.appendChild(s),(s=document.createElement("td")).classList.add("value"),s.textContent=i,e.appendChild(s)},s=I.STATS.stats(this.word,I.SETTINGS.dice,I.SETTINGS.dict),a=document.createElement("table");a.classList.add("roundedTable");let n=document.createElement("tr");i(n,"Grade"," "===s.grade?"S":s.grade),i(n,"Score",s.word?String(s.word.p):"-"),a.appendChild(n),i(n=document.createElement("tr"),"Frequency",s.freq?String(s.freq):"-"),i(n,"Anagram",s.anagram?String(s.anagram.p):"-"),a.appendChild(n),a.appendChild(n),this.defn&&this.define.removeChild(this.defn),this.define.appendChild(t),this.defn=t,this.stats&&this.define.removeChild(this.stats),this.define.appendChild(a),this.stats=a}else this.defn&&(this.define.removeChild(this.defn),this.defn=null),this.stats&&(this.define.removeChild(this.stats),this.stats=null);let t=this.renderAnagrams();this.anagrams&&this.define.removeChild(this.anagrams),this.define.appendChild(t),this.anagrams=t}renderAnagrams(){let e=V.createElementWithId("div","defineAnagrams"),t=I.STATS.anagrams(this.word,I.SETTINGS.dict).words;if(t.length<=1)return e;let i=[],s=new Set;for(let e of t){let a=e.split("").reverse().join("");a!==e&&t.includes(a)?s.add(`${[e,a].sort().join(" ")}`):i.push(e)}let a=e=>{let t=document.createElement(e===this.word?"b":"span");return t.textContent=e,t.addEventListener("click",()=>this.query(e)),t};for(let t of s){let[i,s]=t.split(" ");e.appendChild(document.createTextNode(" (")),e.appendChild(a(i)),e.appendChild(document.createTextNode(" ")),e.appendChild(a(s)),e.appendChild(document.createTextNode(") "))}for(let t of i)e.appendChild(a(t)),e.appendChild(document.createTextNode(" "));return e}async onBeforeInput(e){!(e.inputType.startsWith("delete")||e.data&&D(e.data))&&(e.preventDefault(),(["insertLineBreak","insertParagraph"].includes(e.inputType)||e.data?.includes(" "))&&(this.word?this.query(""):await V.toggleView("Define")))}async onKeyDown(e){if(!this.search)return;let t=e.keyCode;13===t||32===t?(e.preventDefault(),this.word?this.query(""):await V.toggleView("Define")):27===t?await V.toggleView("Define"):[0,37,39,8,46].includes(t)||D(String.fromCharCode(t))||e.preventDefault()}}class x{toJSON(){}attach(){this.menu=V.createElementWithId("div","men");let e=V.createElementWithId("h1","title");e.textContent="BOGGLE",e.addEventListener("long-press",async()=>{let e=(await caches.keys()).find(e=>e.includes(":cache:"));e&&await caches.delete(e),document.location.reload(!0)}),this.menu.appendChild(e);let t=document.createElement("nav"),i=(e,t)=>{let i=document.createElement("button");return i.classList.add("toggle"),i.textContent=e,i.addEventListener("click",t),i};return V.Views.Board.game?(t.appendChild(i("RESUME",()=>V.toggleView("Board"))),t.appendChild(i("NEW GAME",()=>V.toggleView("Board",{new:!0})))):t.appendChild(i("PLAY",()=>V.toggleView("Board"))),t.appendChild(i("TRAIN",()=>V.toggleView("Training"))),t.appendChild(i("DEFINE",()=>V.toggleView("Define"))),t.appendChild(i("STATS",()=>V.toggleView("Stats"))),t.appendChild(i("SETTINGS",()=>V.toggleView("Settings"))),this.menu.appendChild(t),this.menu}detach(){return this.menu}}class O{constructor(e){this.training=e}toJSON(){}async attach(){await this.training.init(),this.review=V.createElementWithId("div","review");let e=V.createBackButton(()=>V.toggleView("Training"));this.review.appendChild(V.createTopbar(e,null,this.training.progress));let t=I.SETTINGS.dice.charAt(0).toLowerCase(),i=e=>I.STATS.anagrams(e,I.SETTINGS.dict)[t]||0,s=new c("training",I.SETTINGS.dict),a=(await s.get("data")||[]).filter(e=>!e.c||e.e<2).sort((e,t)=>i(t.k)/t.e-i(e.k)/e.e).map(e=>e.k),n=V.createElementWithId("div","review-results-wrapper");if(a.length)for(let e of a){let t=V.createElementWithId("table","review-results");V.addAnagramRows(t,l(I.STATS.anagrams(e,I.SETTINGS.dict).words)),n.appendChild(t)}else n.appendChild(V.createPlaceholder());return this.review.appendChild(n),this.review}detach(){return this.review}}class G{constructor(e){this.board=e}toJSON(){}async attach(){await this.board.init(),this.container=V.createElementWithId("div","game");let e=V.createElementWithId("div","score-history"),t=V.createBackButton(()=>V.toggleView("Board"));this.container.appendChild(V.createTopbar(t,this.board.timerDisplay,this.board.score));let i=this.board.game,s=i.state(),a=i.score.regular+i.score.overtime,n=s.totals[I.SETTINGS.grade.toLowerCase()],r=`${a}/${n} (${Math.round(a/n*100).toFixed(0)}%)`,d=$(i.id,r,"block"),l=document.createElement("div");l.classList.add("collapsible-content"),this.displayPlayed(s,l,!0),this.displayPossible(s,l),e.appendChild(d),e.appendChild(l),d.classList.add("active"),l.style.display="block";for(let t=I.HISTORY.length-1;t>=0;t--){let i=I.HISTORY[t],s=0;for(let[e,t]of Object.entries(i.words))t>0&&(s+=v.score(e));if(!s)continue;let a=`${s}/${i.goal[I.SETTINGS.grade]} (${Math.round(s/i.goal[I.SETTINGS.grade]*100).toFixed(0)}%)`,n=document.createElement("div");n.classList.add("collapsible-content"),n.classList.add("lazy");let r=$(i.seed,a,"block",()=>{if(n.classList.contains("lazy")){n.classList.remove("lazy");let e=v.fromJSON(i,I.TRIE,I.DICT,I.STATS).state();this.displayPlayed(e,n),this.displayPossible(e,n)}});e.appendChild(r),e.appendChild(n)}return this.container.appendChild(e),this.container}detach(){return this.container}displayPlayed(e,t,i=!1){let s=e.progress,a=$("PLAYED",`(${s.score}) ${Object.keys(s.suffixes).length}/${s.subwords}/${s.anagrams} (${s.invalid}/${s.total})`,"table"),n=document.createElement("table");for(let{word:t,grade:i,overtime:s,defn:a,invalid:r}of(n.classList.add("collapsible-content"),n.classList.add("results"),n.classList.add("played"),e.played)){let e=document.createElement("tr");!r&&i<I.SETTINGS.grade&&e.classList.add("hard"),r&&e.classList.add("error"),s&&e.classList.add("overtime");let d=document.createElement("td"),l=document.createElement("b");l.textContent=t,d.appendChild(l),e.appendChild(d),d=document.createElement("td"),a&&(d.textContent=a),e.appendChild(d),n.appendChild(e)}i&&(a.classList.add("active"),n.style.display="table"),t.appendChild(a),t.appendChild(n)}displayPossible(e,t,i=!1){let s=e.totals,a=$("POSSIBLE",`${s.d}/${s.c}/${s.b}/${s.a} (${s.s})`,"table"),n=document.createElement("table");for(let{word:t,grade:i,root:s,missing:a,defn:r}of(n.classList.add("collapsible-content"),n.classList.add("results"),n.classList.add("possible"),e.remaining)){let e=document.createElement("tr");i<I.SETTINGS.grade&&e.classList.add("hard");let d=document.createElement("td"),l=document.createElement("b");if(s){let e=document.createElement("span");e.textContent=s;let i=document.createElement("span");i.classList.add("underline"),i.textContent=t.slice(s.length),l.appendChild(e),l.appendChild(i)}else a&&l.classList.add("underline"),l.textContent=t;d.appendChild(l),e.appendChild(d),(d=document.createElement("td")).textContent=r,e.appendChild(d),n.appendChild(e)}i&&(a.classList.add("active"),n.style.display="table"),t.appendChild(a),t.appendChild(n)}}function $(e,t,i,s){let a=document.createElement("button");a.setAttribute("type","button"),a.classList.add("collapsible");let n=document.createElement("div"),r=document.createElement("span");r.classList.add("collapsible-title"),r.textContent=e;let d=document.createElement("span");return d.classList.add("collapsible-details"),d.textContent=t,n.appendChild(r),n.appendChild(d),a.appendChild(n),a.addEventListener("click",()=>{a.classList.toggle("active");let e=a.nextElementSibling;e.style.display===i?e.style.display="none":(s&&s(),e.style.display=i)}),a}const W=new Set(["B","b","N","n","E","e","C","c","O","o","0","1","2","3","4","5","6","7","8","9"]),R=e=>e.split("").every(e=>W.has(e));class B{toJSON(){}attach(){this.settings=V.createElementWithId("div","settings"),this.seed=V.createElementWithId("input","seed"),this.seed.setAttribute("type","text"),this.seed.value=v.encodeID(I.SETTINGS,I.SEED),this.seed.addEventListener("input",()=>this.onInput(this.seed.value||"")),this.seed.addEventListener("beforeinput",e=>this.onBeforeInput(e));let e=V.createBackButton(()=>V.toggleView("Menu"));this.settings.appendChild(V.createTopbar(e,this.seed,null));let t=(e,t,i,s)=>{let a=document.createElement("div");a.classList.add("row");let n=V.createRadios(s||e,t.map(t=>t===String(I.SETTINGS[e])?[t]:t),i);return a.appendChild(n),a};return this.settings.appendChild(t("dice",["New","Old","Big"],function(){let e="Big"===this.value?4:3;document.getElementById(`min${e}`).checked=!0,V.updateSettings({dice:this.value,min:e})})),this.settings.appendChild(t("min",["3","4","5"],function(){V.updateSettings({min:Number(this.value)})})),this.settings.appendChild(t("dict",["NWL","ENABLE","CSW"],function(){V.updateSettings({dict:this.value})})),this.settings.appendChild(t("grade",["A","B","C","D"],function(){V.updateSettings({grade:this.value})})),this.settings.appendChild(t("display",["Hide","Show","Full"],function(){V.updateSettings({display:this.value})},"scoreDisplay")),this.settings.appendChild(t("shortcuts",["Shortcuts","None"],function(){V.updateSettings({shortcuts:this.value})})),this.settings.appendChild(t("theme",["System","Light","Dark"],function(){let e=this.value;V.updateSettings({theme:e}),V.setTheme(e)})),this.settings}detach(){return this.settings}update(){this.seed.textContent=v.encodeID(I.SETTINGS,I.SEED),this.seed.classList.remove("error");let e=e=>document.getElementById(e).checked=!0;e(`dice${I.SETTINGS.dice}`),e(`min${I.SETTINGS.min}`),e(`dict${I.SETTINGS.dict}`),e(`grade${I.SETTINGS.grade}`),e(`scoreDisplay${I.SETTINGS.display}`),e(`shortcuts${I.SETTINGS.shortcuts}`),e(`theme${I.SETTINGS.theme}`)}onInput(e){if(!R(e))return;let[t,i]=v.decodeID(e);V.valid(t,i)?(V.updateSettings(t,i,!1),this.update()):this.seed.classList.add("error")}onBeforeInput(e){e.inputType.startsWith("delete")||e.data&&R(e.data)||e.preventDefault()}async onKeyDown(e){if(!this.seed)return;let t=e.keyCode;[0,37,39,8,46].includes(t)||R(String.fromCharCode(t))||e.preventDefault()}}class M{constructor(e){this.table=null,this.section=e?e.section:"WORD"}toJSON(){return{section:this.section}}async attach(){await I.LOADED.GAMES();let e=I.STATS.history(I.GAMES,I.SETTINGS.dice,I.SETTINGS.dict);this.stats=V.createElementWithId("div","stats");let t=V.createBackButton(()=>V.toggleView("Menu")),i=t=>this.display(t,e),s=V.createRadios("statsSelect",["WORD","ANAGRAM","PAIR"].map(e=>e===this.section?[e]:e),function(){i(this.value),V.persist()});return this.stats.appendChild(V.createTopbar(t,s,null)),this.display(this.section,e),this.stats}detach(){return this.table=null,this.stats}display(e,t){this.section=e;let{words:i,anadromes:s,anagrams:a}=t,n=e=>{let t=document.createElement("b");return t.textContent=e,t.addEventListener("click",()=>V.toggleView("Define",e)),t},r=document.createElement("table");if(r.classList.add("roundedTable"),"PAIR"===e){if(s.length)for(let{n:e,fn:t,d:i,fd:a,e:d}of s){let s=document.createElement("tr"),l=document.createElement("td");l.appendChild(n(e)),s.appendChild(l),(l=document.createElement("td")).textContent=`${t}/${a} (${d})`,s.appendChild(l),(l=document.createElement("td")).appendChild(n(i)),s.appendChild(l),r.appendChild(s)}else r=V.createPlaceholder()}else if("WORD"===e){if(i.length)for(let{w:e,found:t,all:s}of i){let i=document.createElement("tr"),a=document.createElement("td");a.appendChild(n(e)),i.appendChild(a),(a=document.createElement("td")).textContent=`${t}/${s}`,i.appendChild(a),r.appendChild(i)}else r=V.createPlaceholder()}else if(a.length)for(let e of a){let t=document.createElement("tr"),i=document.createElement("td"),s=[],a=!1;for(let{raw:t,found:r,all:d}of e){let e=t.replace(/[^A-Z]/,"");if(t.startsWith("(")){let e=document.createElement("b");e.textContent="(",s.push(e),a=!0}s.push(n(e));let l=document.createElement("span");if(l.textContent=` ${r}/${d}`,t.endsWith(")")){s.push(l);let e=document.createElement("b");e.textContent=")",s.push(e),a=!1}else a&&(l.textContent+=" "),s.push(l);if(!a){for(let e of s)i.appendChild(e);i.appendChild(document.createElement("br")),s=[]}}t.appendChild(i),r.appendChild(t)}else r=V.createPlaceholder();this.table&&this.stats.removeChild(this.table),this.stats.appendChild(r),this.table=r}}class k{toJSON(){}async init(){if(await Promise.all([I.LOADED.TRAINING,I.LOADED.DICT,I.LOADED.STATS()]),!this.pool||this.pool.type!==I.SETTINGS.dict){let e=new c("training",I.SETTINGS.dict);this.pool=await g.create(I.STATS,I.SETTINGS.dice,I.SETTINGS.dict,e,I.SETTINGS.min)}this.progress||(this.progress=V.createElementWithId("div","progress"),this.updateProgress(),this.interval=setInterval(()=>this.updateProgress(),1e3))}async attach(){return await this.init(),this.train=V.createElementWithId("div","train"),this.next(),this.train}async detach(){return this.restore&&this.restore(),this.interval&&clearInterval(this.interval),this.content=null,this.train}next(){let e=V.createElementWithId("div","content"),{label:t,group:i,update:s,restore:a}=this.pool.next();this.restore=a;let n=document.createElement("div");n.classList.add("word"),n.textContent=t;let r=V.createElementWithId("div","sizeHint");r.style.visibility="hidden",r.textContent=String(i.length);let d=this.createRatingToggles(s),l=document.createElement("table");l.classList.add("results","hidden"),V.addAnagramRows(l,i);let o=V.createElementWithId("div","progress-wrapper");o.appendChild(this.progress),o.addEventListener("mouseup",()=>V.toggleView("Review")),o.addEventListener("long-press",()=>{d.classList.contains("hidden")&&(r.style.visibility="visible")}),o.addEventListener("long-press-up",()=>{r.style.visibility="hidden"});let h=V.createBackButton(()=>V.toggleView("Menu"));e.appendChild(V.createTopbar(h,null,o));let c=document.createElement("div");c.classList.add("wrapper"),c.appendChild(n),c.appendChild(l),e.appendChild(c),e.appendChild(r);let u=V.createElementWithId("div","rating-wrapper");u.appendChild(d),e.appendChild(u);let p=t=>{[h,o,this.progress].includes(t.target)||(e.removeEventListener("click",p),n.classList.add("hidden"),r.classList.add("hidden"),l.classList.remove("hidden"),d.classList.remove("hidden"))};e.addEventListener("click",p),this.content&&this.train.removeChild(this.content),this.train.appendChild(e),this.content=e}createRatingToggles(e){let t=document.createElement("div");t.setAttribute("id","rating"),t.classList.add("toggle-group"),t.classList.add("horizontal"),t.classList.add("hidden");for(let i=0;i<6;i++){let s=document.createElement("button");s.setAttribute("id",`rating${i}`),s.setAttribute("type","button"),s.classList.add("toggle"),s.textContent=String(i),t.appendChild(s),s.addEventListener("click",async()=>{await e(Number(s.textContent)),this.updateProgress(),this.restore=null,this.next()})}return t}updateProgress(){this.progress.textContent=`${this.pool.overdue()}\xa0/\xa0${this.pool.size}`}constructor(){this.content=null,this.restore=null,this.interval=null}}class P{attach(){this.loader=V.createElementWithId("div","loader");let e=V.createElementWithId("div","spinner");return this.loader.appendChild(e),this.loader}detach(){return this.loader}}const V=new class{async create(){setTimeout(()=>window.scrollTo(0,1),0),(void 0!==window.orientation||navigator.userAgent.includes("IEMobile"))&&(setTimeout(()=>{let e=document.querySelector("meta[name=viewport]"),t=window.innerWidth,i=window.innerHeight;e.setAttribute("content",`width=${t}, height=${i}, initial-scale=1, user-scalable=no, minimal-ui`)},200),window.addEventListener("orientationchange",()=>{document.body.style.display="none",document.body.offsetHeight,document.body.style.display="block"}));let e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{"System"===I.SETTINGS.theme&&this.setTheme(e.matches?"Dark":"Light")};try{e.addEventListener("change",t)}catch(i){e.addListener(t)}this.setTheme("System"===I.SETTINGS.theme?e.matches?"Dark":"Light":I.SETTINGS.theme),this.root=document.getElementById("display");let i=JSON.parse(localStorage.getItem("state"));this.current=i?i.current:"Menu",this.previous=i?i.previous:"Menu",this.loader=new P;let s=i?i.views:{};for(let[e,t]of(this.Views={},Object.entries({Menu:x,Board:A,Training:k,Define:N,Stats:M,Settings:B})))this.Views[e]=new t(s[e]);this.Views.Review=new O(this.Views.Training),this.Views.Score=new G(this.Views.Board),await this.setup(),this.BACK=document.createElement("img"),this.BACK.src=document.getElementById("svg").src,this.BACK.height=20,document.addEventListener("keydown",e=>this.onKeyDown(e)),document.addEventListener("swiped-left",()=>this.toggleView("Define")),document.addEventListener("swiped-right",()=>this.toggleView("Define")),window.addEventListener("hashchange",()=>this.onHashChange()),window.addEventListener("beforeunload",()=>this.persist()),await this.attachView(this.current)}persist(e=!1){let t=JSON.parse(localStorage.getItem("state"))||{};t.current=this.current,t.previous=this.previous,t.views=t.views||{},t.views[this.current]=this.Views[this.current],e&&(t.views[this.previous]=this.Views[this.previous]),localStorage.setItem("state",JSON.stringify(t))}async attachView(e,t){this.root.appendChild(this.loader.attach());let i=this.Views[e],s=await i.attach(t);this.root.removeChild(this.loader.detach()),this.root.appendChild(s),i.afterAttach&&i.afterAttach()}async detachView(e,t){this.root.removeChild(await this.Views[e].detach(t))}async toggleView(e,t){this.current===e?(await this.detachView(e,this.previous),this.current=this.previous,this.previous=e,await this.attachView(this.current,t)):(await this.detachView(this.current,e),this.previous=this.current,this.current=e,await this.attachView(e,t)),this.persist(!0)}async setup(){let e=async()=>{if(await I.LOADED.HISTORY,I.HISTORY.length){let e=I.HISTORY[I.HISTORY.length-1].seed,[t]=v.decodeID(e),i=new u;i.seed=I.SEED,i.next(),this.updateSettings(t,i.seed%I.MAX_SEED,!1)}},t=document.location.hash?.slice(1);if(t){let[i,s]=v.decodeID(t);if(!this.valid(i,s))return e();this.updateSettings(i,s,!1)}else{let t=this.Views.Board.game;if(!t)return e();{let[e,i]=v.decodeID(t.seed);this.updateSettings(e,i,!1)}}}async onKeyDown(e){let t=e.keyCode,i=this.Views[this.current];191===t&&e.shiftKey?(e.preventDefault(),await this.toggleView("Define")):"onKeyDown"in i&&await i.onKeyDown(e)}async onHashChange(){if(!document.location.hash)return;let[e,t]=v.decodeID(document.location.hash.slice(1));if(!this.valid(e,t))return;let i=t!==I.SEED;if(!i){let t={...I.SETTINGS};i=t.dice!==e.dice||t.min!==e.min||t.dict!==e.dict}if(this.updateSettings(e,t,!1),"Settings"===this.current)this.Views[this.current].update();else if(i&&["Board","Score"].includes(this.current))return this.Views.Board.refresh({new:!0,allowDupes:!0})}valid(e,t){return!!(!isNaN(t)&&Number.isInteger(t)&&t<I.MAX_SEED&&e.dice&&e.dict&&e.min)}updateSettings(e,t,i=!0){Object.assign(I.SETTINGS,e),localStorage.setItem("settings",JSON.stringify(I.SETTINGS)),"number"==typeof t&&(I.SEED=t);let s=v.encodeID(I.SETTINGS,I.SEED);if(window.history.replaceState(null,"",`#${s}`),i&&"Settings"===this.current){let e=this.Views[this.current];e.seed.textContent=s,e.seed.classList.remove("error")}}createElementWithId(e,t){let i=document.createElement(e);return i.setAttribute("id",t),i}createTopbar(e,t,i){let s=this.createElementWithId("header","topbar");return s.appendChild(e||document.createElement("div")),s.appendChild(t||document.createElement("div")),s.appendChild(i||document.createElement("div")),s}createBackButton(e){let t=this.createElementWithId("div","back");return t.appendChild(this.BACK),t.addEventListener("mouseup",e),t}createPlaceholder(){let e=this.createElementWithId("div","empty");return e.textContent="...",e}permaFocus(e){e.addEventListener("blur",()=>setTimeout(()=>e.focus(),20)),e.focus()}setTheme(e){document.documentElement.setAttribute("data-theme",e.toLowerCase())}addAnagramRows(e,t){for(let i of t){let t=i.replace(/[^A-Z]/,""),s=document.createElement("tr");I.STATS.stats(t,I.SETTINGS.dice,I.SETTINGS.dict).grade<I.SETTINGS.grade&&s.classList.add("hard");let a=document.createElement("td"),n=document.createElement("b"),d=i.startsWith("(")?`${i}\xa0`:i.endsWith(")")?`\xa0${i}`:`\xa0${i}\xa0`;n.textContent=`\xa0${d}\xa0`,a.appendChild(n),s.appendChild(a),(a=document.createElement("td")).textContent=r(t,I.DICT),s.appendChild(a),e.appendChild(s)}}createRadios(e,t,i){let s=this.createElementWithId("span",e);for(let a of(s.classList.add("toggle-group"),s.classList.add("horizontal"),s.setAttribute("role","radiogroup"),t)){let t=!1;Array.isArray(a)&&(t=!0,a=a[0]);let n=this.createElementWithId("input",`${e}${a}`);n.classList.add("hide"),n.setAttribute("type","radio"),n.setAttribute("name",e),n.setAttribute("value",a),t&&n.setAttribute("checked","checked");let r=document.createElement("label");r.classList.add("toggle"),r.setAttribute("for",`${e}${a}`),r.textContent=a.toUpperCase(),n.addEventListener("click",i.bind(n)),s.appendChild(n),s.appendChild(r)}return s}},Y=new class{async backup(){let e={history:await I.STORE.get("history")};for(let t of["NWL","ENABLE","CSW"]){let i=new c("training",t);e[t]=await i.get("data")}return e.settings=JSON.parse(localStorage.getItem("settings")),JSON.stringify(e)}async restore(e){for(let t of(await I.STORE.set("history",e.history),["NWL","ENABLE","CSW"])){let i=new c("training",t);await i.set("data",e[t])}localStorage.setItem("settings",JSON.stringify(e.settings))}async modify(e,t){let i;let s=new c("training",I.SETTINGS.dict),a=await g.create(I.STATS,I.SETTINGS.dice,I.SETTINGS.dict,s,I.SETTINGS.min),n=o.toAnagram(e),r=a.learned,d=[];for(i=r.pop();i&&i.k!==n;i=r.pop())d.push(i);if(!i)throw RangeError();for(let e of(r.push(t(i)),d))r.push(e);return s.set("data",r.data)}get state(){return JSON.parse(localStorage.getItem("state"))}};window.global=I,window.UI=V,window.Debug=Y,V.create();
//# sourceMappingURL=index.f70a23f0.js.map
